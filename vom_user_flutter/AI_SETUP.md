# AI 음성 챗봇 설정 가이드

## 개요
V.O.M 앱에 AI 음성 챗봇 기능이 추가되었습니다. 제한된 주제(육아/건강/아이돌봄)에서 음성으로 상호작용할 수 있습니다.

## 기능
- **음성 인식(STT)**: 사용자의 음성을 텍스트로 변환
- **AI 대화**: OpenAI GPT-4o-mini를 활용한 자연스러운 대화
- **음성 출력(TTS)**: AI 응답을 음성으로 재생
- **컨텍스트 인식**: 현재 학습 중인 카드 내용을 기반으로 답변

## OpenAI API 키 설정 (선택)

API 키가 없어도 **오프라인 키워드 기반 응답**으로 동작합니다.

### 1. OpenAI API 키 발급
1. https://platform.openai.com/api-keys 접속
2. "Create new secret key" 클릭
3. API 키 복사 (sk-...로 시작)

### 2. 코드에 API 키 입력
`lib/services/ai_chat_service.dart` 파일을 열고:

```dart
static const String _apiKey = 'YOUR_OPENAI_API_KEY'; // 여기에 복사한 키 입력
```

예시:
```dart
static const String _apiKey = 'sk-proj-abc123...';
```

### 3. 비용
- **무료 크레딧**: 신규 가입 시 $5 제공
- **GPT-4o-mini 가격**:
  - 입력: $0.15 / 1M tokens (약 750,000 단어)
  - 출력: $0.60 / 1M tokens
- **예상 비용**: 대화 1회당 약 $0.001 (한화 1.3원)

## 오프라인 모드 (기본)

API 키가 없으면 다음과 같이 작동합니다:

### 지원하는 키워드
- **응급 상황**: "열", "다쳤어", "피", "숨", "기침"
- **일반 육아**: "약", "밥", "이유식", "울어", "잠"
- **현재 학습**: "어떻게", "방법", "사용법"

### 예시 대화
```
사용자: "열이 많아요"
AI: "아이에게 열이 높으면 옷을 가볍게 입히고, 38.5도가 넘으면 해열제를 주세요. 39도 이상이면 병원에 가세요."

사용자: "체온계 어떻게 사용해요?" (학습 중일 때)
AI: "체온계 사용법을 다시 들려드릴까요? 화면의 다시 듣기 버튼을 눌러주세요."
```

## 사용 방법

### 1. 홈 화면에서
- 오른쪽 하단 로봇 아이콘(🤖) 버튼 클릭
- 일반적인 육아 질문 가능

### 2. 학습 화면에서
- 상단 로봇 아이콘 버튼 클릭
- 현재 배우고 있는 내용에 대해 질문 가능

### 3. 음성 입력
1. 마이크 버튼을 **꾹 누르고** 말하기
2. 버튼에서 손을 떼면 자동으로 인식
3. AI가 생각한 후 음성으로 답변

## 안전 기능

### 1. 주제 제한
- 육아/건강/아이돌봄 외의 질문은 정중히 거절
- 예: "날씨", "뉴스", "게임" 등은 답변 안 함

### 2. 의료 진단 금지
- AI는 의료 진단이나 처방을 하지 않음
- 심각한 증상은 병원 방문 권유

### 3. 응급 상황 대응
- 위급한 상황에는 119 전화 안내

## 권한

### Android
- **RECORD_AUDIO**: 음성 인식을 위한 마이크 접근
- **INTERNET**: AI API 통신 (오프라인 모드는 불필요)

### iOS
- `Info.plist`에 마이크 권한 설명 추가됨
- "음성으로 질문하기 위해 마이크 권한이 필요합니다"

## 문제 해결

### 음성 인식이 안 돼요
1. 앱 설정에서 마이크 권한 확인
2. 조용한 환경에서 시도
3. 버튼을 누른 상태에서 말하기

### AI가 응답하지 않아요
1. 인터넷 연결 확인 (오프라인 모드는 키워드만 지원)
2. API 키가 올바른지 확인
3. OpenAI 크레딧 잔액 확인

### 응답이 느려요
- GPT-4o-mini는 약 1-3초 소요
- 네트워크 속도에 따라 다를 수 있음
- 오프라인 모드는 즉시 응답

## 추가 개선 아이디어

### 1. 무료 대안
- **Google Cloud TTS**: 월 100만 자 무료
- **ElevenLabs**: 월 10,000자 무료 (고품질 음성)

### 2. 로컬 AI
- TensorFlow Lite로 온디바이스 AI 구현
- 네트워크 없이도 작동

### 3. 더 나은 컨텍스트
- 이전 학습 기록 반영
- 사용자별 맞춤형 답변
